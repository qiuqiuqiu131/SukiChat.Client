<suki:SukiWindow xmlns="https://github.com/avaloniaui"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:vm="using:ChatClient.Desktop.ViewModels"
                 xmlns:prism="http://prismlibrary.com/"
                 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                 xmlns:avalonia="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
                 xmlns:suki="clr-namespace:SukiUI.Controls;assembly=SukiUI"
                 xmlns:dialogs="clr-namespace:SukiUI.Dialogs;assembly=SukiUI"
                 xmlns:userControls="clr-namespace:ChatClient.Desktop.Views.UserControls"
                 xmlns:data="clr-namespace:ChatClient.Tool.Data;assembly=ChatClient.Tool"
                 xmlns:circleImage="clr-namespace:ChatClient.Avalonia.Controls.CircleImage;assembly=ChatClient.Avalonia"
                 Theme="{StaticResource MySukiWindowTheme}"
                 mc:Ignorable="d"
                 Width="1050"
                 Height="680"
                 MinHeight="500"
                 MinWidth="800"
                 TitleBarAnimationEnabled="False"
                 Padding="15,5"
                 x:Class="ChatClient.Desktop.Views.MainWindowView"
                 x:DataType="vm:MainWindowViewModel"
                 prism:ViewModelLocator.AutoWireViewModel="True"
                 WindowStartupLocation="CenterScreen"
                 BackgroundAnimationEnabled="{Binding  CurrentThemeStyle.AnimationsEnabled}"
                 BackgroundStyle="{Binding CurrentThemeStyle.BackgroundStyle}"
                 BackgroundTransitionsEnabled="{Binding CurrentThemeStyle.TransitionsEnabled}"
                 Icon="/Assets/ChartDonutVariant.ico"
                 ShowTitlebarBackground="False"
                 FontFamily="{StaticResource MiSans}"
                 Title="Suki Chat">
    <Window.Resources>
        <!-- <DataTemplate x:Key="MessageBox" x:DataType="data:UserDto"> -->
        <!--     <Popup IsOpen="False" IsLightDismissEnabled="True"> -->
        <!--         <userControls:UserMessageBox /> -->
        <!--     </Popup> -->
        <!-- </DataTemplate> -->
        <ControlTheme x:Key="{x:Type suki:SukiDialog}" TargetType="suki:SukiDialog">
            <Setter Property="ClipToBounds" Value="False" />
            <Setter Property="Template">
                <ControlTemplate>
                    <Panel>
                        <Border Padding="0" Margin="0,20,0,0"
                                ClipToBounds="True" MinWidth="450"
                                CornerRadius="25">
                            <Panel>
                                <Border IsVisible="{TemplateBinding ShowCardBackground}" CornerRadius="25"
                                        Background="{DynamicResource SukiCardBackground}">
                                    <Panel Background="{DynamicResource PopupGradientBrush}" Margin="-5">
                                    </Panel>
                                </Border>
                                <Grid RowDefinitions="Auto,Auto,*,Auto"
                                      ColumnDefinitions="*"
                                      Margin="30,15,30,0"
                                      IsVisible="{Binding !IsViewModelOnly, RelativeSource={RelativeSource TemplatedParent}}">
                                    <Border Grid.Row="0" Margin="0,10,0,0"
                                            IsVisible="{TemplateBinding IconColor, Converter={x:Static ObjectConverters.IsNotNull}}">
                                    </Border>
                                    <TextBlock Grid.Row="1" Margin="0,24,0,0"
                                               IsVisible="{TemplateBinding Title,Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                               HorizontalAlignment="Center" FontSize="22" FontWeight="DemiBold"
                                               Text="{TemplateBinding Title}" />
                                    <ContentControl Grid.Row="2" Margin="0,24,0,0"
                                                    MaxWidth="{TemplateBinding Content, Converter={x:Static dialogs:DialogContentMaxWidthValueConverter.Instance}}"
                                                    Content="{TemplateBinding Content}">
                                        <ContentControl.Styles>
                                            <Style Selector="TextBlock">
                                                <Setter Property="FontSize" Value="14" />
                                                <Setter Property="TextWrapping" Value="Wrap" />
                                            </Style>
                                        </ContentControl.Styles>
                                    </ContentControl>
                                    <ItemsControl Grid.Row="3" Margin="0,26,0,0"
                                                  ItemsSource="{TemplateBinding ActionButtons}">
                                        <ItemsControl.Styles>
                                            <Style Selector="Button">
                                                <Setter Property="Margin" Value="15,0,0,25" />
                                            </Style>
                                        </ItemsControl.Styles>
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" />
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                    </ItemsControl>
                                </Grid>
                                <ContentControl Content="{TemplateBinding ViewModel}" Margin="15"
                                                IsVisible="{TemplateBinding IsViewModelOnly}" />
                            </Panel>
                        </Border>
                        <Border CornerRadius="40" HorizontalAlignment="Center"
                                VerticalAlignment="Top"
                                Margin="0,-23,0,0" Width="80" Height="80">
                            <Panel>
                                <Border Width="80" HorizontalAlignment="Center"
                                        Height="80"
                                        IsVisible="{TemplateBinding IconColor, Converter={x:Static ObjectConverters.IsNotNull}}"

                                        BoxShadow="{DynamicResource SukiBigPopupShadow}"
                                        CornerRadius="40" />
                                <Ellipse HorizontalAlignment="Center" VerticalAlignment="Center" Width="80" Height="80"
                                         Fill="{TemplateBinding IconColor}" />
                                <PathIcon HorizontalAlignment="Center" VerticalAlignment="Center"
                                          Data="{TemplateBinding Icon}"
                                          Foreground="White"
                                          Width="25"
                                          Height="25" />
                            </Panel>
                        </Border>
                    </Panel>
                </ControlTemplate>
            </Setter>
        </ControlTheme>
    </Window.Resources>

    <Window.Styles>
        <Style Selector="TrayIcon">
            <Setter Property="TextBlock.FontSize" Value="12" />
        </Style>
    </Window.Styles>

    <Panel>
        <suki:SukiSideMenu IsSearchEnabled="False"
                           IsMenuExpanded="False"
                           IsToggleButtonVisible="False"
                           Theme="{StaticResource SukiSideMenuStyle}"
                           ItemsSource="{Binding ChatPages}"
                           CloseMenuClicked="Button_OnClick"
                           SelectedItem="{Binding ActivePage}">
            <suki:SukiSideMenu.Styles>
                <Style Selector="Image.AppIcon">
                    <Setter Property="Transitions">
                        <Transitions>
                            <DoubleTransition Property="Opacity" Duration="0.1" />
                        </Transitions>
                    </Setter>
                    <Style Selector="^:pointerover">
                        <Setter Property="Opacity" Value="0.7" />
                    </Style>
                </Style>
            </suki:SukiSideMenu.Styles>

            <suki:SukiSideMenu.ItemTemplate>
                <DataTemplate>
                    <suki:SukiSideMenuItem FontWeight="SemiBold" FontSize="13"
                                           Padding="15,5"
                                           CornerRadius="7"
                                           Classes="Compact"
                                           IsTopMenuExpanded="True"
                                           Header="{Binding DisplayName}">
                        <suki:SukiSideMenuItem.Icon>
                            <avalonia:MaterialIcon Width="20" Height="20" Margin="5" Kind="{Binding Icon}" />
                        </suki:SukiSideMenuItem.Icon>
                    </suki:SukiSideMenuItem>
                </DataTemplate>
            </suki:SukiSideMenu.ItemTemplate>

            <suki:SukiSideMenu.HeaderContent>
                <StackPanel Orientation="Vertical" Margin="0,10">
                    <Panel Width="80" Height="80">
                        <Panel.Clip>
                            <EllipseGeometry Center="40,40" RadiusX="40" RadiusY="40" />
                        </Panel.Clip>
                        <Image Width="80"
                               Height="80"
                               Classes="AppIcon"
                               Source="{Binding User.HeadImage}" />
                    </Panel>
                    <TextBlock Classes="h3" Margin="0,10" FontSize="15" HorizontalAlignment="Center"
                               Text="{Binding User.Name}" />
                </StackPanel>
            </suki:SukiSideMenu.HeaderContent>
            <suki:SukiSideMenu.LeftBottomContent>
                <circleImage:CircleImage Size="38" Image="{Binding User.HeadImage}" Margin="0,10,0,15"
                                         PointerPressed="InputElement_OnPointerPressed" />
            </suki:SukiSideMenu.LeftBottomContent>
            <suki:SukiSideMenu.FooterContent>
                <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                    <StackPanel.Styles>
                        <Style Selector="Button">
                            <Setter Property="Width" Value="40" />
                            <Setter Property="Height" Value="40" />
                        </Style>
                        <Style Selector="Button avalonia|MaterialIcon">
                            <Setter Property="Width" Value="25" />
                            <Setter Property="Height" Value="25" />
                            <Setter Property="Transitions">
                                <Transitions>
                                    <DoubleTransition Property="Width" Duration="0.1" />
                                    <DoubleTransition Property="Height" Duration="0.1" />
                                </Transitions>
                            </Setter>
                        </Style>

                        <Style Selector="Button:pointerover avalonia|MaterialIcon">
                            <Setter Property="Width" Value="28" />
                            <Setter Property="Height" Value="28" />
                        </Style>
                    </StackPanel.Styles>
                    <Button Classes="Basic"
                            Command="{Binding ExitCommnad}"
                            ToolTip.ShowDelay="500"
                            RenderTransformOrigin="50%,50%">
                        <avalonia:MaterialIcon Kind="ExitToApp" />
                        <ToolTip.Tip>
                            <TextBlock Text="退出登录" FontSize="12" />
                        </ToolTip.Tip>
                    </Button>
                </StackPanel>
            </suki:SukiSideMenu.FooterContent>
        </suki:SukiSideMenu>

        <Popup IsOpen="False" Name="MessageBox" IsLightDismissEnabled="True" DataContext="{x:Null}">
            <userControls:UserMessageBox />
        </Popup>

        <Border Name="BackgroundBorder" Background="#66000000" Opacity="0" IsVisible="False">
            <Border.Transitions>
                <Transitions>
                    <DoubleTransition Property="Opacity" Duration="0:0:0.4" Easing="CubicEaseOut" />
                </Transitions>
            </Border.Transitions>
        </Border>
    </Panel>

</suki:SukiWindow>