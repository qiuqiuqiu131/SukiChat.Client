<UserControl
    x:Class="ChatClient.Desktop.Views.ChatPages.ChatViews.ChatLeftPanelView"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:avalonia="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
    xmlns:chatViews="clr-namespace:ChatClient.Desktop.Views.ChatPages.ChatViews"
    xmlns:circleImage="clr-namespace:ChatClient.Avalonia.Controls.CircleImage;assembly=ChatClient.Avalonia"
    xmlns:converter="clr-namespace:ChatClient.Avalonia.Converter;assembly=ChatClient.Avalonia"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:data="clr-namespace:ChatClient.Tool.Data;assembly=ChatClient.Tool"
    xmlns:group="clr-namespace:ChatClient.Tool.Data.Group;assembly=ChatClient.Tool"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:searchBox="clr-namespace:ChatClient.Avalonia.Controls.SearchBox;assembly=ChatClient.Avalonia"
    xmlns:suki="https://github.com/kikipoulet/SukiUI"
    xmlns:vm="clr-namespace:ChatClient.Desktop.ViewModels.ChatPages.ChatViews"
    d:DesignHeight="650"
    d:DesignWidth="300"
    x:DataType="vm:ChatLeftPanelViewModel"
    FontSize="15"
    mc:Ignorable="d">
    <UserControl.Resources>
        <converter:ChatMessageToStringConverter x:Key="ChatMessageToStringConverter" />
        <converter:DateTimeConverter x:Key="DateTimeConverter" />
        <DataTemplate x:Key="FriendMenu" DataType="data:FriendRelationDto">
            <ContextMenu Padding="0,0,10,0" Closed="OnContextMenuClosed">
                <MenuItem
                    Click="OnFriendTopMenuItemClick"
                    Header="取消置顶"
                    IsVisible="{Binding IsTop}">
                    <MenuItem.Icon>
                        <avalonia:MaterialIcon Kind="ArrowExpandDown" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem
                    Click="OnFriendTopMenuItemClick"
                    Header="置顶聊天"
                    IsVisible="{Binding !IsTop}">
                    <MenuItem.Icon>
                        <avalonia:MaterialIcon Kind="ArrowCollapseUp" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Click="OnFriendCopyIdClick" Header="复制群ID">
                    <MenuItem.Icon>
                        <avalonia:MaterialIcon Kind="ContentCopy" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem
                    Click="OnFriendDisturbMenuItemClick"
                    Header="接受消息提醒"
                    IsVisible="{Binding CantDisturb}">
                    <MenuItem.Icon>
                        <avalonia:MaterialIcon Kind="BellOutline" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem
                    Click="OnFriendDisturbMenuItemClick"
                    Header="消息免打扰"
                    IsVisible="{Binding !CantDisturb}">
                    <MenuItem.Icon>
                        <avalonia:MaterialIcon Kind="BellOffOutline" />
                    </MenuItem.Icon>
                </MenuItem>
                <Separator Margin="5" />
                <MenuItem Click="OnFriendClearMenuItemClick" Header="删除聊天">
                    <MenuItem.Icon>
                        <avalonia:MaterialIcon Kind="DeleteOutline" />
                    </MenuItem.Icon>
                </MenuItem>
            </ContextMenu>
        </DataTemplate>
        <DataTemplate x:Key="GroupMenu" DataType="group:GroupRelationDto">
            <ContextMenu Padding="0,0,10,0" Closed="OnContextMenuClosed">
                <MenuItem
                    Click="OnGroupTopMenuItemClick"
                    Header="取消置顶"
                    IsVisible="{Binding IsTop}">
                    <MenuItem.Icon>
                        <avalonia:MaterialIcon Kind="ArrowExpandDown" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem
                    Click="OnGroupTopMenuItemClick"
                    Header="置顶聊天"
                    IsVisible="{Binding !IsTop}">
                    <MenuItem.Icon>
                        <avalonia:MaterialIcon Kind="ArrowCollapseUp" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Click="OnGroupCopyIdClick" Header="复制群ID">
                    <MenuItem.Icon>
                        <avalonia:MaterialIcon Kind="ContentCopy" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem
                    Click="OnGroupDisturbMenuItemClick"
                    Header="接收消息提醒"
                    IsVisible="{Binding CantDisturb}">
                    <MenuItem.Icon>
                        <avalonia:MaterialIcon Kind="BellOutline" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem
                    Click="OnGroupDisturbMenuItemClick"
                    Header="消息免打扰"
                    IsVisible="{Binding !CantDisturb}">
                    <MenuItem.Icon>
                        <avalonia:MaterialIcon Kind="BellOffOutline" />
                    </MenuItem.Icon>
                </MenuItem>
                <Separator Margin="5" />
                <MenuItem Click="OnGroupClearMenuItemClick" Header="删除聊天">
                    <MenuItem.Icon>
                        <avalonia:MaterialIcon Kind="DeleteOutline" />
                    </MenuItem.Icon>
                </MenuItem>
            </ContextMenu>
        </DataTemplate>
    </UserControl.Resources>
    <UserControl.Styles>
        <Style Selector="RadioButton.IsTop">
            <Setter Property="Background" Value="{DynamicResource SukiControlBorderBrush}" />
            <Style Selector="^ /template/ Border">
                <Setter Property="Opacity" Value="0.3" />
            </Style>
            <Style Selector="^:pointerover">
                <Setter Property="BorderBrush" Value="{DynamicResource SukiPrimaryColor25}" />
                <Style Selector="^ /template/ Border">
                    <Setter Property="Opacity" Value="0.3" />
                    <Setter Property="Background" Value="{DynamicResource SukiPrimaryColor25}" />
                    <Setter Property="CornerRadius" Value="5" />
                </Style>
                <Style Selector="^ /template/ ContentPresenter#PART_ContentPresenter">
                    <Setter Property="CornerRadius" Value="5" />
                </Style>
            </Style>
            <Style Selector="^:checked">
                <Setter Property="BorderBrush" Value="{DynamicResource SukiPrimaryColor50}" />
                <Style Selector="^ /template/ Border">
                    <Setter Property="Opacity" Value="0.3" />
                    <Setter Property="Background" Value="{DynamicResource SukiPrimaryColor75}" />
                    <Setter Property="CornerRadius" Value="13" />
                </Style>
                <Style Selector="^ /template/ ContentPresenter#PART_ContentPresenter">
                    <Setter Property="CornerRadius" Value="13" />
                </Style>
            </Style>
        </Style>
        <Style Selector="RadioButton.Enter:visible">
            <Style.Animations>
                <Animation
                    Easing="CubicEaseInOut"
                    FillMode="Forward"
                    IterationCount="1"
                    Duration="0:0:0.3">
                    <KeyFrame Cue="0%">
                        <Setter Property="ScaleTransform.ScaleX" Value="0" />
                        <Setter Property="ScaleTransform.ScaleY" Value="0" />
                    </KeyFrame>
                    <KeyFrame Cue="100%">
                        <Setter Property="ScaleTransform.ScaleX" Value="1" />
                        <Setter Property="ScaleTransform.ScaleY" Value="1" />
                    </KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>
    </UserControl.Styles>
    <UserControl.DataTemplates>
        <DataTemplate DataType="data:FriendChatDto">
            <RadioButton
                Height="65"
                Margin="0"
                Classes="Chat Content Enter"
                Classes.IsTop="{Binding FriendRelatoinDto.IsTop}"
                Click="Button_OnClick"
                Command="{Binding ((vm:ChatLeftPanelViewModel)DataContext).FriendSelectionChangedCommand, RelativeSource={RelativeSource AncestorType=ItemsControl, Mode=FindAncestor}}"
                CommandParameter="{Binding}"
                CornerRadius="0"
                GroupName="ChatLeft"
                PointerPressed="Button_OnPointerPressed"
                RenderTransformOrigin="0.5,0.5">
                <Grid Name="Root_Grid" ColumnDefinitions="42,*">
                    <!--  头像  -->
                    <circleImage:CircleImage Image="{Binding FriendRelatoinDto.UserDto.HeadImage}" Size="42" />
                    <!--  简略信息  -->
                    <Grid
                        Grid.Column="1"
                        Margin="10,4,0,4"
                        RowDefinitions="1.2*,1*">
                        <Grid Grid.Row="0" ColumnDefinitions="*,auto">
                            <Grid Grid.Column="0">
                                <TextBlock
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Center"
                                    Foreground="{DynamicResource SukiText}"
                                    IsVisible="{Binding FriendRelatoinDto.Remark, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                    Text="{Binding FriendRelatoinDto.Remark}"
                                    TextTrimming="CharacterEllipsis" />
                                <TextBlock
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Center"
                                    Foreground="{DynamicResource SukiText}"
                                    IsVisible="{Binding FriendRelatoinDto.Remark, Converter={x:Static StringConverters.IsNullOrEmpty}}"
                                    Text="{Binding FriendRelatoinDto.UserDto.Name}"
                                    TextTrimming="CharacterEllipsis" />
                            </Grid>
                            <TextBlock
                                Name="Time_Text"
                                Grid.Column="1"
                                Margin="0,5"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Top"
                                FontSize="11.5"
                                Foreground="{DynamicResource SukiText}"
                                Opacity="0.6"
                                Text="{Binding LastChatMessages.Time, Converter={StaticResource DateTimeConverter}}" />
                        </Grid>
                        <Grid Grid.Row="1" ColumnDefinitions="*,auto">
                            <TextBlock
                                Name="Chat_Mess_Txt"
                                Grid.Column="0"
                                Margin="0,0,20,0"
                                VerticalAlignment="Center"
                                FontSize="12"
                                Foreground="{DynamicResource SukiText}"
                                Opacity="0.6"
                                Text="{Binding LastChatMessages.ChatMessages, Converter={StaticResource ChatMessageToStringConverter}}"
                                TextTrimming="CharacterEllipsis" />
                            <Panel Grid.Column="1">
                                <Panel
                                    IsVisible="{Binding UnReadMessageCount, Converter={converter:IntEqualityConverter Value=0}}">
                                    <avalonia:MaterialIcon
                                        Width="16"
                                        Height="16"
                                        IsVisible="{Binding FriendRelatoinDto.CantDisturb}"
                                        Kind="BellOffOutline"
                                        Opacity="0.4" />
                                </Panel>
                                <Border
                                    Height="16"
                                    Margin="0,0"
                                    Padding="5,0"
                                    HorizontalAlignment="Right"
                                    Classes.CantDisturb="{Binding FriendRelatoinDto.CantDisturb}"
                                    CornerRadius="8"
                                    IsVisible="{Binding UnReadMessageCount, Converter={converter:IntEqualityConverter Equal=False, Value=0}}">
                                    <Border.Styles>
                                        <Style Selector="Border">
                                            <Setter Property="Background" Value="Red" />
                                        </Style>
                                        <Style Selector="Border.CantDisturb">
                                            <Setter Property="Background"
                                                    Value="{DynamicResource SukiControlBorderBrush}" />
                                        </Style>
                                    </Border.Styles>
                                    <TextBlock
                                        Margin="2,0,-1,0"
                                        Padding="0"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        FontSize="11"
                                        Foreground="White"
                                        Text="{Binding UnReadMessageCount, Converter={converter:UnReadMessageCountConverter}}" />
                                </Border>
                            </Panel>
                        </Grid>
                    </Grid>
                </Grid>
            </RadioButton>
        </DataTemplate>
        <DataTemplate DataType="group:GroupChatDto">
            <RadioButton
                Height="65"
                Margin="0"
                Classes="Chat Content Enter"
                Classes.IsTop="{Binding GroupRelationDto.IsTop}"
                Click="Button_OnClick"
                Command="{Binding ((vm:ChatLeftPanelViewModel)DataContext).GroupSelectionChangedCommand, RelativeSource={RelativeSource AncestorType=ItemsControl, Mode=FindAncestor}}"
                CommandParameter="{Binding}"
                CornerRadius="0"
                GroupName="ChatLeft"
                PointerPressed="Button_OnPointerPressed"
                RenderTransformOrigin="0.5,0.5">
                <Grid Name="Root_Grid" ColumnDefinitions="42,*">
                    <!--  头像  -->
                    <circleImage:CircleImage Image="{Binding GroupRelationDto.GroupDto.HeadImage}" Size="42" />
                    <!--  简略信息  -->
                    <Grid
                        Grid.Column="1"
                        Margin="10,4,0,4"
                        RowDefinitions="1.2*,1*">
                        <Grid Grid.Row="0" ColumnDefinitions="*,auto">
                            <Grid Grid.Column="0">
                                <TextBlock
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Center"
                                    Foreground="{DynamicResource SukiText}"
                                    IsVisible="{Binding GroupRelationDto.Remark, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                    Text="{Binding GroupRelationDto.Remark}"
                                    TextTrimming="CharacterEllipsis" />
                                <TextBlock
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Center"
                                    Foreground="{DynamicResource SukiText}"
                                    IsVisible="{Binding GroupRelationDto.Remark, Converter={x:Static StringConverters.IsNullOrEmpty}}"
                                    Text="{Binding GroupRelationDto.GroupDto.Name}"
                                    TextTrimming="CharacterEllipsis" />
                            </Grid>
                            <TextBlock
                                Name="Time_Text"
                                Grid.Column="1"
                                Margin="0,5"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Top"
                                FontSize="11.5"
                                Foreground="{DynamicResource SukiText}"
                                Opacity="0.6"
                                Text="{Binding LastChatMessages.Time, Converter={StaticResource DateTimeConverter}}" />
                        </Grid>
                        <Grid Grid.Row="1" ColumnDefinitions="*,auto">
                            <Grid Grid.Column="0"
                                  IsVisible="{Binding LastChatMessages, Converter={converter:NullValueConverter}}">
                                <TextBlock
                                    Margin="0,0,20,0"
                                    VerticalAlignment="Center"
                                    FontSize="12"
                                    Foreground="{DynamicResource SukiText}"
                                    IsVisible="{Binding !LastChatMessages.IsSystem}"
                                    Opacity="0.6"
                                    TextTrimming="CharacterEllipsis">
                                    <Run Text="{Binding LastChatMessages.Owner.NickName}" />
                                    <Run Text=":" />
                                    <Run
                                        Text="{Binding LastChatMessages.ChatMessages, Mode=OneWay, Converter={StaticResource ChatMessageToStringConverter}}" />
                                </TextBlock>
                                <TextBlock
                                    Margin="0,0,20,0"
                                    VerticalAlignment="Center"
                                    FontSize="12"
                                    Foreground="{DynamicResource SukiText}"
                                    IsVisible="{Binding LastChatMessages.IsSystem}"
                                    Opacity="0.6"
                                    TextTrimming="CharacterEllipsis">
                                    <Run
                                        Text="{Binding LastChatMessages.ChatMessages, Mode=OneWay, Converter={StaticResource ChatMessageToStringConverter}}" />
                                </TextBlock>
                            </Grid>
                            <Panel Grid.Column="1">
                                <Panel
                                    IsVisible="{Binding UnReadMessageCount, Converter={converter:IntEqualityConverter Value=0}}">
                                    <avalonia:MaterialIcon
                                        Width="16"
                                        Height="16"
                                        IsVisible="{Binding GroupRelationDto.CantDisturb}"
                                        Kind="BellOffOutline"
                                        Opacity="0.4" />
                                </Panel>
                                <Border
                                    Height="16"
                                    Margin="0,0"
                                    Padding="5,0"
                                    HorizontalAlignment="Right"
                                    Classes.CantDisturb="{Binding GroupRelationDto.CantDisturb}"
                                    CornerRadius="8"
                                    IsVisible="{Binding UnReadMessageCount, Converter={converter:IntEqualityConverter Equal=False, Value=0}}">
                                    <Border.Styles>
                                        <Style Selector="Border">
                                            <Setter Property="Background" Value="Red" />
                                        </Style>
                                        <Style Selector="Border.CantDisturb">
                                            <Setter Property="Background"
                                                    Value="{DynamicResource SukiControlBorderBrush}" />
                                        </Style>
                                    </Border.Styles>
                                    <TextBlock
                                        Margin="0,0,0,1"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        FontSize="11"
                                        Padding="0"
                                        Foreground="White"
                                        Text="{Binding UnReadMessageCount, Converter={converter:UnReadMessageCountConverter}}" />
                                </Border>
                            </Panel>
                        </Grid>
                    </Grid>
                </Grid>
            </RadioButton>
        </DataTemplate>
    </UserControl.DataTemplates>
    <chatViews:ChatLeftPanelView.FriendItemsSource>
        <Binding Path="ChatViewModel.Friends" />
    </chatViews:ChatLeftPanelView.FriendItemsSource>
    <chatViews:ChatLeftPanelView.GroupItemsSource>
        <Binding Path="ChatViewModel.Groups" />
    </chatViews:ChatLeftPanelView.GroupItemsSource>
    <Grid Margin="0" RowDefinitions="70,*">
        <suki:GlassCard
            Grid.Row="0"
            Grid.RowSpan="2"
            Margin="0"
            Padding="0"
            CornerRadius="0"
            Opacity="0.5" />
        <!--  顶部  -->
        <suki:GlassCard
            Grid.Row="0"
            Height="70"
            Margin="0,0,0,0"
            Padding="8"
            BorderThickness="0,0,0,1.5"
            CornerRadius="2">
            <DockPanel LastChildFill="True">
                <Button
                    Name="PART_AddButton"
                    Width="27"
                    Height="27"
                    Margin="7,3,0,1"
                    Padding="0"
                    VerticalAlignment="Bottom"
                    Background="{DynamicResource SukiBorderBrush}"
                    Classes="Add"
                    Click="PART_AddButton_OnClick"
                    CornerRadius="8"
                    DockPanel.Dock="Right">
                    <avalonia:MaterialIcon HorizontalAlignment="Center" Kind="Plus" />
                </Button>
                <searchBox:SearchBox SearchText="{Binding SearchText}" WaterMask="搜索" />
            </DockPanel>
        </suki:GlassCard>
        <!--  好友列表  -->
        <ScrollViewer
            Grid.Row="1"
            HorizontalScrollBarVisibility="Disabled"
            VerticalScrollBarVisibility="Hidden">
            <ItemsControl
                x:Name="Items"
                Margin="0,0,0,40"
                suki:ItemsControlExtensions.AnimatedScroll="True">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Orientation="Vertical" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.Styles>
                    <Style Selector="RadioButton.Content">
                        <Style Selector="^ Grid#Root_Grid">
                            <Setter Property="Margin" Value="6,5,6,5" />
                            <Setter Property="Transitions">
                                <Transitions>
                                    <ThicknessTransition
                                        Easing="SineEaseInOut"
                                        Property="Margin"
                                        Duration="0:0:0.25" />
                                </Transitions>
                            </Setter>
                        </Style>
                    </Style>

                    <Style Selector="RadioButton.Content:checked">
                        <Style Selector="^ Grid#Root_Grid">
                            <Setter Property="Margin" Value="17,5,17,5" />
                        </Style>
                    </Style>
                </ItemsControl.Styles>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</UserControl>