<UserControl
    x:Class="ChatClient.Desktop.Views.Login.LoginView"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:avalonia="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:p1="https://github.com/kikipoulet/SukiUI"
    xmlns:suki="clr-namespace:SukiUI.Controls;assembly=SukiUI"
    xmlns:behaviors="clr-namespace:ChatClient.Avalonia.Behaviors;assembly=ChatClient.Avalonia"
    xmlns:sukiColor="clr-namespace:SukiUI.ColorTheme;assembly=SukiUI"
    xmlns:controls="clr-namespace:Avalonia.Notification.Controls;assembly=Notification.Avalonia"
    xmlns:circleImage="clr-namespace:ChatClient.Avalonia.Controls.CircleImage;assembly=ChatClient.Avalonia"
    xmlns:data="clr-namespace:ChatClient.Tool.Data;assembly=ChatClient.Tool"
    xmlns:login="clr-namespace:ChatClient.Desktop.ViewModels.Login"
    xmlns:mvvm="http://prismlibrary.com/"
    mvvm:ViewModelLocator.AutoWireViewModel="True"
    d:DesignHeight="480"
    d:DesignWidth="320"
    x:DataType="login:LoginViewModel"
    mc:Ignorable="d">
    <Grid RowDefinitions="25,*">
        <!-- 顶部栏 -->
        <Panel Height="25" Margin="0,2" Background="Transparent">
            <Interaction.Behaviors>
                <behaviors:WindowDragBehavior />
            </Interaction.Behaviors>
            <StackPanel IsHitTestVisible="False" Orientation="Horizontal" HorizontalAlignment="Left"
                        VerticalAlignment="Center" Margin="6,2,0,0">
                <avalonia:MaterialIcon
                    IsVisible="{Binding SelectedLoginItem,Converter={x:Static ObjectConverters.IsNotNull}}"
                    HorizontalAlignment="Center" VerticalAlignment="Center"
                    Width="20"
                    Height="20"
                    Foreground="{DynamicResource SukiPrimaryColor}"
                    Kind="ChartDonutVariant" />
                <TextBlock Text="Suki Chat" FontWeight="SemiBold" Foreground="{DynamicResource SukiPrimaryColor}"
                           VerticalAlignment="Center" Margin="2.5,1,0,0"
                           FontSize="12.5" />
            </StackPanel>

            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="5,0">
                <Panel Margin="8,0" IsVisible="{Binding !IsConnected.IsConnected}" ToolTip.ShowDelay="250"
                       ToolTip.Placement="Bottom" ToolTip.VerticalOffset="5"
                       ToolTip.HorizontalOffset="-10">
                    <ToolTip.Tip>
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <PathIcon Data="{x:Static p1:Icons.CircleWarning}"
                                      Width="17.5" Height="17.5"
                                      Opacity="0.9"
                                      Foreground="{x:Static sukiColor:NotificationColor.ErrorIconForeground}" />
                            <TextBlock Text="网络连接断开" FontSize="13" Opacity="0.75" Foreground="Red" />
                        </StackPanel>
                    </ToolTip.Tip>
                    <avalonia:MaterialIcon
                        Width="17"
                        Height="17"
                        Foreground="{x:Static sukiColor:NotificationColor.ErrorIconForeground}"
                        Kind="WifiStrengthAlertOutline" />
                </Panel>
                <Button Margin="0,4" HorizontalAlignment="Left" Classes="Void"
                        Click="Button_OnClick" ToolTip.VerticalOffset="4" ToolTip.HorizontalOffset="-10"
                        ToolTip.ShowDelay="250" ToolTip.Placement="Bottom">
                    <ToolTip.Tip>
                        <TextBlock Text="登录设置" FontSize="13" />
                    </ToolTip.Tip>
                    <Button.ContextMenu>
                        <ContextMenu Placement="BottomEdgeAlignedRight" VerticalOffset="-5">
                            <MenuItem Header="登录管理" Command="{CompiledBinding LoginSettingCommand}">
                                <MenuItem.Icon>
                                    <avalonia:MaterialIcon Kind="AccountMultipleOutline" />
                                </MenuItem.Icon>
                            </MenuItem>
                            <MenuItem Header="网络配置" Command="{CompiledBinding NetSettingCommand}">
                                <MenuItem.Icon>
                                    <avalonia:MaterialIcon Kind="Web" />
                                </MenuItem.Icon>
                            </MenuItem>
                        </ContextMenu>
                    </Button.ContextMenu>
                    <avalonia:MaterialIcon Kind="SettingsOutline" Width="16.5" Height="16.5" />
                </Button>
                <Button Name="PART_CloseButton"
                        HorizontalAlignment="Right"
                        Classes="Basic Rounded WindowControlsButton Close">
                    <Interaction.Behaviors>
                        <EventTriggerBehavior EventName="Click">
                            <CallMethodAction TargetObject="{Binding $parent[Window]}"
                                              MethodName="Close" />
                        </EventTriggerBehavior>
                    </Interaction.Behaviors>
                    <PathIcon Data="{x:Static p1:Icons.WindowClose}" Height="8" Width="8" />
                </Button>
            </StackPanel>
        </Panel>

        <!-- 主体 -->
        <suki:BusyArea Grid.Row="1" Classes="Qiu" IsBusy="{Binding IsBusy}" BusyText="登录中...">
            <DockPanel LastChildFill="True">
                <!-- 底部导航 -->
                <StackPanel
                    Margin="0,0,0,15"
                    HorizontalAlignment="Center"
                    DockPanel.Dock="Bottom"
                    Orientation="Horizontal"
                    Spacing="65">
                    <StackPanel.Styles>
                        <Style Selector="Button.Login">
                            <Setter Property="Height" Value="45" />
                            <Setter Property="Width" Value="45" />
                            <Setter Property="HorizontalContentAlignment" Value="Center" />
                            <Setter Property="CornerRadius" Value="30" />
                            <Setter Property="BorderThickness" Value="1" />
                            <Setter Property="BorderBrush" Value="#afafaf" />
                            <Setter Property="Background" Value="Transparent"></Setter>
                            <Style Selector="^:pointerover">
                                <Setter Property="Background" Value="#99cfcfcf" />
                            </Style>
                        </Style>
                        <Style Selector="avalonia|MaterialIcon">
                            <Setter Property="Width" Value="20" />
                            <Setter Property="Margin" Value="-7.5,3" />
                            <Setter Property="Height" Value="20" />
                            <Setter Property="Foreground" Value="{DynamicResource TextBlockDefaultForeground}" />
                            <Setter Property="Opacity" Value="0.6" />
                        </Style>
                        <Style Selector="TextBlock">
                            <Setter Property="Opacity" Value="0.6" />
                            <Setter Property="FontSize" Value="12.5" />
                        </Style>
                    </StackPanel.Styles>
                    <StackPanel Orientation="Vertical" Spacing="5">
                        <Button Classes="Login" Command="{Binding ToRegisterViewCommand}">
                            <avalonia:MaterialIcon Foreground="{DynamicResource SemiColorGrayText}" Kind="Add" />
                        </Button>
                        <TextBlock Text="注册账号" />
                    </StackPanel>
                    <StackPanel Orientation="Vertical" Spacing="5">
                        <Button Classes="Login" Command="{Binding ToForgetViewCommand}">
                            <avalonia:MaterialIcon Kind="ForgotPassword" />
                        </Button>
                        <TextBlock Text="忘记密码" />
                    </StackPanel>
                </StackPanel>

                <!-- 登录表单 -->
                <StackPanel
                    Width="250"
                    HorizontalAlignment="Center"
                    Orientation="Vertical" Spacing="5">
                    <StackPanel.Styles>
                        <Style Selector="TextBlock.title">
                            <Setter Property="FontSize" Value="16" />
                            <Setter Property="Margin" Value="8,0,0,0" />
                        </Style>
                        <Style Selector="TextBox.input,AutoCompleteBox.input">
                            <Setter Property="FontSize" Value="15" />
                            <Setter Property="ContextMenu" Value="{StaticResource DefaultTextBoxContextMenu}" />
                        </Style>
                    </StackPanel.Styles>

                    <!-- 头像 -->
                    <Panel Margin="0,40,0,15"
                           HorizontalAlignment="Center" Width="90" Height="90">
                        <avalonia:MaterialIcon
                            Width="95"
                            Height="95"
                            Margin="-3"
                            IsVisible="{Binding SelectedLoginItem,Converter={x:Static ObjectConverters.IsNull}}"
                            Foreground="{DynamicResource SukiPrimaryColor}"
                            Kind="ChartDonutVariant" />
                        <Panel Width="89" Height="89"
                               IsVisible="{Binding SelectedLoginItem,Converter={x:Static ObjectConverters.IsNotNull}}">
                            <Ellipse Width="89" Height="89" Fill="{DynamicResource SukiPrimaryColor75}" />
                            <circleImage:CircleImage
                                Size="85" Margin="0.5,1,0,0" Image="{Binding SelectedLoginItem.Head}" />
                        </Panel>
                    </Panel>

                    <!-- ID -->
                    <AutoCompleteBox
                        x:Name="IDBox"
                        MaxLength="10"
                        MinimumPrefixLength="4"
                        Classes="Login input"
                        Padding="7,12.5"
                        ContextMenu="{x:Null}"
                        MaxDropDownHeight="200"
                        ItemsSource="{Binding UserList}"
                        CornerRadius="8"
                        Watermark="输入用户ID"
                        Text="{Binding Id}">
                        <AutoCompleteBox.Styles>
                            <Style Selector="AutoCompleteBox.Login /template/ TextBox#PART_TextBox">
                                <Setter Property="LetterSpacing" Value="1" />
                                <Setter Property="TextAlignment" Value="Center" />
                                <!-- <Setter Property="p1:TextBoxExtensions.AddDeleteButton" Value="True" /> -->
                            </Style>
                        </AutoCompleteBox.Styles>
                        <AutoCompleteBox.InnerLeftContent>
                            <avalonia:MaterialIcon Kind="AccountOutline" Width="22" Height="22" />
                        </AutoCompleteBox.InnerLeftContent>
                        <AutoCompleteBox.ItemTemplate>
                            <DataTemplate DataType="data:LoginUserItem">
                                <DockPanel Margin="0" LastChildFill="True" HorizontalAlignment="Stretch">
                                    <circleImage:CircleImage
                                        DockPanel.Dock="Left"
                                        Margin="10,0,0,0"
                                        Image="{Binding Head}" Size="35" />
                                    <StackPanel Orientation="Vertical" HorizontalAlignment="Center"
                                                VerticalAlignment="Center">
                                        <TextBlock FontSize="13.5" HorizontalAlignment="Center" LetterSpacing="1"
                                                   Text="{Binding ID,StringFormat='ID: {0}'}" />
                                        <TextBlock
                                            Text="{Binding LastLoginTime}"
                                            HorizontalAlignment="Center" Classes="Small"
                                            FontSize="12" Opacity="0.65" />
                                    </StackPanel>
                                </DockPanel>
                            </DataTemplate>
                        </AutoCompleteBox.ItemTemplate>
                    </AutoCompleteBox>

                    <!-- 密码 -->
                    <TextBox
                        MaxLength="16"
                        Padding="7,13,7,11"
                        Classes="Login input Password"
                        TextAlignment="Center"
                        ContextFlyout="{x:Null}"
                        ContextMenu="{x:Null}"
                        Text="{Binding Password}"
                        Watermark="输入密码">
                        <TextBox.InnerLeftContent>
                            <avalonia:MaterialIcon Kind="LockOutline" Width="20" Height="20" />
                        </TextBox.InnerLeftContent>
                    </TextBox>

                    <!-- 记住密码 -->
                    <CheckBox IsVisible="False" Margin="6,5,5,0" IsChecked="{Binding LoginData.RememberPassword}">
                        <TextBlock
                            FontSize="13.5"
                            Text="记住密码"
                            Foreground="{DynamicResource SukiLowText}" />
                    </CheckBox>

                    <!-- 登录 -->
                    <Button
                        Width="240"
                        Height="38"
                        CornerRadius="8"
                        Margin="0,25,0,0"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Bottom"
                        Classes="Flat"
                        Command="{Binding LoginCommand}">
                        <TextBlock FontSize="15" Text="登录" />
                    </Button>
                </StackPanel>
            </DockPanel>
        </suki:BusyArea>

        <!-- 通知消息容器 -->
        <controls:NotificationMessageContainer Grid.Row="0" Grid.RowSpan="2"
                                               Manager="{Binding NotificationManager}" />
    </Grid>
</UserControl>